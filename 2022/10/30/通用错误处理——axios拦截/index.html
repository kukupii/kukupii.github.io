<!DOCTYPE html>
<html lang="en">
    <head>
    <meta charset="utf-8">

    

    <!-- 渲染优化 -->
    <meta name="renderer" content="webkit">
    <meta name="force-rendering" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
    <meta name="HandheldFriendly" content="True" >
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

    <!--icon-->

    
        <link rel="shortcut icon" href="/favicon.ico">
    
    
    
    
    


    <!-- meta -->


<title>通用错误处理——axios拦截 | Loplooop</title>


    <meta name="keywords" content="typescript, vue, zheye, error">




    <!-- OpenGraph -->
 
    <meta name="description" content="重点：  组件改用函数调用形式。  使用Vnode组成VitrualDom，并使用render function渲染。   通用错误处理Axios 拦截器的文档地址:Interceptors | Axios Docs 示例代码: &#x2F;&#x2F; Add a request interceptoraxios.interceptors.request.use(function (config) &amp;#123;">
<meta property="og:type" content="article">
<meta property="og:title" content="通用错误处理——axios拦截">
<meta property="og:url" content="https://kukupii.github.io/2022/10/30/%E9%80%9A%E7%94%A8%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86%E2%80%94%E2%80%94axios%E6%8B%A6%E6%88%AA/index.html">
<meta property="og:site_name" content="Loplooop">
<meta property="og:description" content="重点：  组件改用函数调用形式。  使用Vnode组成VitrualDom，并使用render function渲染。   通用错误处理Axios 拦截器的文档地址:Interceptors | Axios Docs 示例代码: &#x2F;&#x2F; Add a request interceptoraxios.interceptors.request.use(function (config) &amp;#123;">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://vuejs.org/assets/render-pipeline.03805016.png">
<meta property="article:published_time" content="2022-10-30T03:44:23.000Z">
<meta property="article:modified_time" content="2022-11-17T08:44:02.472Z">
<meta property="article:author" content="John Doe">
<meta property="article:tag" content="typescript">
<meta property="article:tag" content="vue">
<meta property="article:tag" content="zheye">
<meta property="article:tag" content="error">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://vuejs.org/assets/render-pipeline.03805016.png">


    
<link rel="stylesheet" href="/css/style/main.css">
 

    
    
        <link rel="stylesheet" id="hl-default-theme" href="https://cdn.jsdelivr.net/npm/hexo-theme-cards@1.2/dist/css/highlight/github.min.css" media="none" >
        
            <link rel="stylesheet" id="hl-dark-theme" href="https://cdn.jsdelivr.net/npm/hexo-theme-cards@1.2/dist/css/highlight/atom-one-dark-reasonable.min.css" media="none">
        
    

    
    

    
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-theme-cards@1.2/dist/css/style/dark.min.css">

    
<script src="https://cdn.jsdelivr.net/npm/hexo-theme-cards@1.2/dist/js/darkmode.min.js"></script>



     

    <!-- custom head -->

<meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/atom.xml" title="Loplooop" type="application/atom+xml">
</head>

    <body>
        <div id="app" tabindex="-1">
            <header class="header">
    <div class="header__left">
        <a href="/" class="button">
            <span class="logo__text">Loploop</span>
        </a>
    </div>
    <div class="header__right">
        
            <div class="navbar__menus">
                
                    <a href="/" class="navbar-menu button">Home</a>
                
                    <a href="/tags/" class="navbar-menu button">Tags</a>
                
                    <a href="/archives/" class="navbar-menu button">Archives</a>
                
                    <a href="/friends/" class="navbar-menu button">Friends</a>
                
                    <a href="/page/" class="navbar-menu button">Page</a>
                
            </div>
        
        
        
    <a href="/search/" id="btn-search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1024 1024" width="24" height="24" fill="currentColor" stroke="currentColor" stroke-width="32"><path d="M192 448c0-141.152 114.848-256 256-256s256 114.848 256 256-114.848 256-256 256-256-114.848-256-256z m710.624 409.376l-206.88-206.88A318.784 318.784 0 0 0 768 448c0-176.736-143.264-320-320-320S128 271.264 128 448s143.264 320 320 320a318.784 318.784 0 0 0 202.496-72.256l206.88 206.88 45.248-45.248z"></path></svg>
    </a>


        
        
    <a href="javaScript:void(0);" id="btn-toggle-dark">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path></svg>
    </a>


        
            <a class="dropdown-icon button" id="btn-dropdown" tabindex="0"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" width='24' height='24' fill="none" stroke="currentColor" stroke-width="0.7" stroke-linecap="round" stroke-linejoin="round"><path fill="currentColor" d="M3.314,4.8h13.372c0.41,0,0.743-0.333,0.743-0.743c0-0.41-0.333-0.743-0.743-0.743H3.314c-0.41,0-0.743,0.333-0.743,0.743C2.571,4.467,2.904,4.8,3.314,4.8z M16.686,15.2H3.314c-0.41,0-0.743,0.333-0.743,0.743s0.333,0.743,0.743,0.743h13.372c0.41,0,0.743-0.333,0.743-0.743S17.096,15.2,16.686,15.2z M16.686,9.257H3.314c-0.41,0-0.743,0.333-0.743,0.743s0.333,0.743,0.743,0.743h13.372c0.41,0,0.743-0.333,0.743-0.743S17.096,9.257,16.686,9.257z"></path></svg></a>
            <div class="dropdown-menus" id="dropdown-menus">
                
                    <a href="/" class="dropdown-menu button">Home</a>
                
                    <a href="/tags/" class="dropdown-menu button">Tags</a>
                
                    <a href="/archives/" class="dropdown-menu button">Archives</a>
                
                    <a href="/friends/" class="dropdown-menu button">Friends</a>
                
                    <a href="/page/" class="dropdown-menu button">Page</a>
                
            </div>
        
    </div>
</header>


            <main class="main">
    

<div class="post-title">
    <h1 class="post-title__text">
        通用错误处理——axios拦截
    </h1>
    <div class="post-title__meta">
        <a href="/archives/2022/10/" class="post-meta__date button">2022-10-30</a>
        
 
        
    
    


 

 
    </div>
</div>


    <aside class="post-side">
        <div class="post-side__toc">
            <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%80%9A%E7%94%A8%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86"><span class="toc-number">1.</span> <span class="toc-text">通用错误处理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E5%A4%9A%E7%A7%8D%E6%83%85%E5%86%B5%E9%80%82%E7%94%A8%E7%9A%84Message%E7%BB%84%E4%BB%B6"><span class="toc-number">2.</span> <span class="toc-text">创建多种情况适用的Message组件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%86%E8%A7%A3Vnode"><span class="toc-number">3.</span> <span class="toc-text">了解Vnode</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Render-Pipeline"><span class="toc-number">3.0.1.</span> <span class="toc-text">Render Pipeline</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Render-function"><span class="toc-number">3.0.2.</span> <span class="toc-text">Render function</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%9B%E5%BB%BAVnode%E4%BB%A5%E5%8F%8A%E4%BD%BF%E7%94%A8Render-function"><span class="toc-number">4.</span> <span class="toc-text">创建Vnode以及使用Render function</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%9B%E5%BB%BAVnode"><span class="toc-number">4.0.1.</span> <span class="toc-text">创建Vnode</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A3%B0%E6%98%8E-Render-Function"><span class="toc-number">4.0.2.</span> <span class="toc-text">声明 Render Function</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8-JSX"><span class="toc-number">4.0.3.</span> <span class="toc-text">使用 JSX</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B0%86%E7%BB%84%E4%BB%B6%E6%94%B9%E4%B8%BA%E5%87%BD%E6%95%B0%E8%B0%83%E7%94%A8%E5%BD%A2%E5%BC%8F%E5%B9%B6%E4%BD%BF%E7%94%A8h%E5%87%BD%E6%95%B0"><span class="toc-number">5.</span> <span class="toc-text">将组件改为函数调用形式并使用h函数</span></a></li></ol>
        </div>
    </aside>
    <a class="btn-toc button" id="btn-toc" tabindex="0">
        <svg viewBox="0 0 1024 1024" width="32" height="32" xmlns="http://www.w3.org/2000/svg">
            <path d="M128 256h64V192H128zM320 256h576V192H320zM128 544h64v-64H128zM320 544h576v-64H320zM128 832h64v-64H128zM320 832h576v-64H320z" fill="currentColor"></path>
        </svg>
    </a>
    <div class="toc-menus" id="toc-menus">
        <div class="toc-title">Article Directory</div>
        <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%80%9A%E7%94%A8%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86"><span class="toc-number">1.</span> <span class="toc-text">通用错误处理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E5%A4%9A%E7%A7%8D%E6%83%85%E5%86%B5%E9%80%82%E7%94%A8%E7%9A%84Message%E7%BB%84%E4%BB%B6"><span class="toc-number">2.</span> <span class="toc-text">创建多种情况适用的Message组件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%86%E8%A7%A3Vnode"><span class="toc-number">3.</span> <span class="toc-text">了解Vnode</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Render-Pipeline"><span class="toc-number">3.0.1.</span> <span class="toc-text">Render Pipeline</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Render-function"><span class="toc-number">3.0.2.</span> <span class="toc-text">Render function</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%9B%E5%BB%BAVnode%E4%BB%A5%E5%8F%8A%E4%BD%BF%E7%94%A8Render-function"><span class="toc-number">4.</span> <span class="toc-text">创建Vnode以及使用Render function</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%9B%E5%BB%BAVnode"><span class="toc-number">4.0.1.</span> <span class="toc-text">创建Vnode</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A3%B0%E6%98%8E-Render-Function"><span class="toc-number">4.0.2.</span> <span class="toc-text">声明 Render Function</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8-JSX"><span class="toc-number">4.0.3.</span> <span class="toc-text">使用 JSX</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B0%86%E7%BB%84%E4%BB%B6%E6%94%B9%E4%B8%BA%E5%87%BD%E6%95%B0%E8%B0%83%E7%94%A8%E5%BD%A2%E5%BC%8F%E5%B9%B6%E4%BD%BF%E7%94%A8h%E5%87%BD%E6%95%B0"><span class="toc-number">5.</span> <span class="toc-text">将组件改为函数调用形式并使用h函数</span></a></li></ol>
    </div>


<article class="post post__with-toc content-card">
    <div class="post__header"></div>
    <div class="post__content">
        <p>重点：</p>
<ol>
<li><p>组件改用函数调用形式。</p>
</li>
<li><p>使用Vnode组成VitrualDom，并使用render function渲染。</p>
</li>
</ol>
<h2 id="通用错误处理"><a href="#通用错误处理" class="headerlink" title="通用错误处理"></a>通用错误处理</h2><p>Axios 拦截器的文档地址:<a target="_blank" rel="noopener" href="https://axios-http.com/docs/interceptors">Interceptors | Axios Docs</a></p>
<p>示例代码:</p>
<figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// Add a request interceptor</span></span><br><span class="line">axios.<span class="property">interceptors</span>.<span class="property">request</span>.<span class="title function_">use</span>(<span class="keyword">function</span> (<span class="params">config</span>) &#123;</span><br><span class="line">    <span class="comment">// Do something before request is sent</span></span><br><span class="line">    <span class="keyword">return</span> config;</span><br><span class="line">  &#125;, <span class="keyword">function</span> (<span class="params">error</span>) &#123;</span><br><span class="line">    <span class="comment">// Do something with request error</span></span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">reject</span>(error);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Add a response interceptor</span></span><br><span class="line">axios.<span class="property">interceptors</span>.<span class="property">response</span>.<span class="title function_">use</span>(<span class="keyword">function</span> (<span class="params">response</span>) &#123;</span><br><span class="line">    <span class="comment">// Any status code that lie within the range of 2xx cause this function to trigger</span></span><br><span class="line">    <span class="comment">// Do something with response data</span></span><br><span class="line">    <span class="keyword">return</span> response;</span><br><span class="line">  &#125;, <span class="keyword">function</span> (<span class="params">error</span>) &#123;</span><br><span class="line">    <span class="comment">// Any status codes that falls outside the range of 2xx cause this function to trigger</span></span><br><span class="line">    <span class="comment">// Do something with response error</span></span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">reject</span>(error);</span><br><span class="line">  &#125;);</span><br></pre></td></tr></table></figure>

<p>实际代码：</p>
<figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// main.ts中</span></span><br><span class="line">axios.<span class="property">interceptors</span>.<span class="property">request</span>.<span class="title function_">use</span>(<span class="function">(<span class="params">config</span>) =&gt;</span> &#123;</span><br><span class="line"> <span class="comment">//把错误复原，以免错误窗口只出现一次</span></span><br><span class="line">  store.<span class="title function_">setError</span>(<span class="literal">false</span>, <span class="string">&quot;&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> config;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">axios.<span class="property">interceptors</span>.<span class="property">response</span>.<span class="title function_">use</span>(</span><br><span class="line">  <span class="function">(<span class="params">config</span>) =&gt;</span> &#123;</span><br><span class="line">    store.<span class="title function_">setLoading</span>(<span class="literal">false</span>);</span><br><span class="line">    <span class="keyword">return</span> config;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">//解构错误信息</span></span><br><span class="line">    <span class="keyword">const</span> &#123; error &#125; = e.<span class="property">response</span>.<span class="property">data</span>;</span><br><span class="line">    <span class="comment">//设置error</span></span><br><span class="line">    store.<span class="title function_">setError</span>(<span class="literal">true</span>, error);</span><br><span class="line">    store.<span class="title function_">setLoading</span>(ftyalse);</span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">reject</span>(error);</span><br><span class="line">  &#125;</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//store.ts中</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">ErrorProps</span> &#123;</span><br><span class="line">  <span class="attr">status</span>: <span class="built_in">boolean</span>;</span><br><span class="line">  message?: <span class="built_in">string</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> useMainStore = <span class="title function_">defineStore</span>(<span class="string">&quot;main&quot;</span>, &#123;</span><br><span class="line">  <span class="attr">state</span>: <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="attr">error</span>: &#123; <span class="attr">status</span>: <span class="literal">false</span> &#125; <span class="keyword">as</span> <span class="title class_">ErrorProps</span>,</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">actions</span>:&#123;</span><br><span class="line">    <span class="title function_">setError</span>(<span class="params">status: <span class="built_in">boolean</span>, msg: <span class="built_in">string</span></span>) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">error</span> = &#123; <span class="attr">status</span>: status, <span class="attr">message</span>: msg &#125;;</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="创建多种情况适用的Message组件"><a href="#创建多种情况适用的Message组件" class="headerlink" title="创建多种情况适用的Message组件"></a>创建多种情况适用的Message组件</h2><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">Teleport</span> <span class="attr">to</span>=<span class="string">&quot;#message&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">div</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">class</span>=<span class="string">&quot;alert message-info fixed-top w-50 mx-auto d-flex justify-content-between mt-2&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">v-if</span>=<span class="string">&quot;isVisible&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">:class</span>=<span class="string">&quot;classObject&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">    &gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">span</span>&gt;</span>&#123;&#123; message &#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">type</span>=<span class="string">&quot;button&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">class</span>=<span class="string">&quot;close&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">aria-label</span>=<span class="string">&quot;Close&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        @<span class="attr">click.prevent</span>=<span class="string">&quot;close&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      &gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">span</span> <span class="attr">aria-hidden</span>=<span class="string">&quot;true&quot;</span>&gt;</span>×<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">Teleport</span>&gt;</span></span></span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span> <span class="attr">lang</span>=<span class="string">&quot;ts&quot;</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">import</span> &#123; defineComponent, <span class="title class_">PropType</span>, ref &#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">import</span> useDOMCreate <span class="keyword">from</span> <span class="string">&quot;../hooks/useDOMCreate&quot;</span>;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">export</span> type <span class="title class_">MessageType</span> = <span class="string">&quot;error&quot;</span> | <span class="string">&quot;success&quot;</span> | <span class="string">&quot;default&quot;</span>;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title function_">defineComponent</span>(&#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="attr">props</span>: &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="attr">message</span>: &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="attr">type</span>: <span class="title class_">String</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="attr">type</span>: &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="attr">type</span>: <span class="title class_">String</span> <span class="keyword">as</span> <span class="title class_">PropType</span>&lt;<span class="title class_">MessageType</span>&gt;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="attr">default</span>: <span class="string">&quot;default&quot;</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  &#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="attr">emits</span>: [<span class="string">&quot;close-message&quot;</span>],</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="title function_">setup</span>(<span class="params">props, context</span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="title function_">useDOMCreate</span>(<span class="string">&quot;message&quot;</span>);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">const</span> isVisible = <span class="title function_">ref</span>(<span class="literal">true</span>);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">const</span> classObject = &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="string">&quot;alert-success&quot;</span>: props.<span class="property">type</span> === <span class="string">&quot;success&quot;</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="string">&quot;alert-danger&quot;</span>: props.<span class="property">type</span> === <span class="string">&quot;error&quot;</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="string">&quot;alert-primary&quot;</span>: props.<span class="property">type</span> === <span class="string">&quot;default&quot;</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">const</span> <span class="title function_">close</span> = (<span class="params"></span>) =&gt; &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      isVisible.<span class="property">value</span> = <span class="literal">false</span>;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      context.<span class="title function_">emit</span>(<span class="string">&quot;close-message&quot;</span>);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">return</span> &#123; isVisible, classObject, close &#125;;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  &#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">&#125;);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br></pre></td></tr></table></figure>

<h2 id="了解Vnode"><a href="#了解Vnode" class="headerlink" title="了解Vnode"></a>了解Vnode</h2><p>文档地址：<a target="_blank" rel="noopener" href="https://vuejs.org/guide/extras/rendering-mechanism.html#virtual-dom">virtual-dom</a></p>
<p><strong>Virtual DOM：一种虚拟的，保存在内存中的数据结构，用来代表 UI 的表现</strong>，和真实 DOM 节点保持同步。Virtual DOM是由一系列的 Vnode 组成的。</p>
<figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 模拟一个简单的 Vnode</span></span><br><span class="line"><span class="keyword">const</span> vnode = &#123;</span><br><span class="line">  <span class="attr">type</span>: <span class="string">&#x27;div&#x27;</span>,</span><br><span class="line">  <span class="attr">props</span>: &#123;</span><br><span class="line">    <span class="attr">id</span>: <span class="string">&#x27;hello&#x27;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">children</span>: [</span><br><span class="line">    <span class="comment">/* more vnodes */</span></span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Here, <code>vnode</code> is a plain JavaScript object (a “virtual node”) representing a <code>&lt;div&gt;</code> element. It contains all the information that we need to create the actual element. It also contains more children vnodes, which makes it the root of a virtual DOM tree.</p>
<p>A runtime renderer can walk a virtual DOM tree and construct a real DOM tree from it. This process is called <strong>mount</strong>.</p>
<p>If we have two copies of virtual DOM trees, the renderer can also walk and compare the two trees, figuring out the differences, and apply those changes to the actual DOM. This process is called <strong>patch</strong>, also known as “diffing” or “reconciliation”.</p>
<p>patch 的过程主要就是使用 diff 算法计算差别，然后更新的过程。</p>
<h4 id="Render-Pipeline"><a href="#Render-Pipeline" class="headerlink" title="Render Pipeline"></a>Render Pipeline</h4><ul>
<li><strong>Compile</strong>， Vue 组件的 Template 会被编译成 <strong>render function</strong>，一个可以返回 Virtual DOM 树的函数。</li>
<li><strong>Mount</strong>，执行 render function，遍历虚拟DOM 树，生成真正的 DOM 节点。</li>
<li><strong>Patch</strong>，当组件中任何响应式对象（依赖）发生变化的时候，执行更新操作 。生成新的虚拟节点树，Vue 内部会遍历新的虚拟节点树，和旧的树做对比，然后执行<strong>必要</strong>的更新。</li>
</ul>
<p><img src="https://vuejs.org/assets/render-pipeline.03805016.png" class="lazy" data-srcset="https://vuejs.org/assets/render-pipeline.03805016.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABAQMAAAAl21bKAAAABlBMVEXMzMyWlpYU2uzLAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAACklEQVQImWNgAAAAAgAB9HFkpgAAAABJRU5ErkJggg=="></p>
<h4 id="Render-function"><a href="#Render-function" class="headerlink" title="Render function"></a>Render function</h4><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 在 main.ts 中</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">App</span>)</span><br><span class="line"><span class="comment">// 返回</span></span><br><span class="line"><span class="title class_">Object</span></span><br><span class="line">  <span class="attr">components</span>: &#123;<span class="title class_">HelloWorld</span>: &#123;…&#125;&#125;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&quot;App&quot;</span></span><br><span class="line">  <span class="attr">render</span>: ƒ <span class="title function_">render</span>(_ctx, _cache, $props, $setup, $data, $options)</span><br><span class="line">  <span class="attr">setup</span>: ƒ ()  </span><br><span class="line"></span><br><span class="line"><span class="comment">// 原始的 template</span></span><br><span class="line">&lt;template&gt;</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">HelloWorld</span> <span class="attr">msg</span>=<span class="string">&quot;axyz&quot;</span>/&gt;</span></span></span><br><span class="line">  &#123;&#123; hello &#125;&#125;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment">// template 会被转换成这样的 function</span></span><br><span class="line">  <span class="keyword">const</span> _component_HelloWorld = <span class="title function_">_resolveComponent</span>(<span class="string">&quot;HelloWorld&quot;</span>)!</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (<span class="title function_">_openBlock</span>(), <span class="title function_">_createElementBlock</span>(_Fragment, <span class="literal">null</span>, [</span><br><span class="line">    <span class="title function_">_createVNode</span>(_component_HelloWorld, &#123; <span class="attr">msg</span>: <span class="string">&quot;axyz&quot;</span> &#125;),</span><br><span class="line">    <span class="title function_">_createTextVNode</span>(<span class="string">&quot; &quot;</span> + <span class="title function_">_toDisplayString</span>(_ctx.<span class="property">hello</span>), <span class="number">1</span> <span class="comment">/* TEXT */</span>)</span><br><span class="line">  ], <span class="number">64</span> <span class="comment">/* STABLE_FRAGMENT */</span>))</span><br></pre></td></tr></table></figure>

<h2 id="创建Vnode以及使用Render-function"><a href="#创建Vnode以及使用Render-function" class="headerlink" title="创建Vnode以及使用Render function"></a>创建Vnode以及使用Render function</h2><h4 id="创建Vnode"><a href="#创建Vnode" class="headerlink" title="创建Vnode"></a>创建Vnode</h4><p>h和createVnode都可以创建Vnode。两个用法差不多，后者名称更形象。</p>
<p>h 是 hyperscript 的缩写，意思就是 “JavaScript that produces HTML (hypertext markup language)”，很多 virtualDOM 的实现都使用这个函数名称。</p>
<figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; h, createVnode &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> vnode = <span class="title function_">h</span>(</span><br><span class="line">  <span class="string">&#x27;div&#x27;</span>, <span class="comment">// type</span></span><br><span class="line">  &#123; <span class="attr">id</span>: <span class="string">&#x27;foo&#x27;</span>, <span class="attr">class</span>: <span class="string">&#x27;bar&#x27;</span> &#125;, <span class="comment">// props</span></span><br><span class="line">  [</span><br><span class="line">    <span class="comment">/* children */</span></span><br><span class="line">  ]</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<h4 id="声明-Render-Function"><a href="#声明-Render-Function" class="headerlink" title="声明 Render Function"></a>声明 Render Function</h4><p>当使用 composition API 的时候，在 setup 当中直接返回一个对象，代表着给模版使用的数据，当要使用 render function 的时候，可以直接返回一个函数。</p>
<figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="title function_">setup</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> message = <span class="title function_">ref</span>(<span class="number">1</span>)</span><br><span class="line">  <span class="comment">// 使用 template</span></span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    message</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 使用 render function</span></span><br><span class="line">  <span class="keyword">return</span> <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">h</span>(<span class="string">&#x27;div&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="使用-JSX"><a href="#使用-JSX" class="headerlink" title="使用 JSX"></a><strong>使用 JSX</strong></h4><p>是 h 函数的一种语法糖。可以将这种类似 HTML 的语法转换成 h 函数的写法。</p>
<p>添加JSX支持：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">vue add babel</span><br></pre></td></tr></table></figure>

<figure class="highlight tsx"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 创建 vnode</span></span><br><span class="line"><span class="keyword">const</span> vnode = <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>hello<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="comment">// 使用变量</span></span><br><span class="line"><span class="keyword">const</span> vnode = <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&#123;dynamicId&#125;</span>&gt;</span>hello, &#123;userName&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br></pre></td></tr></table></figure>

<p>ts文件要将后缀名改为<strong>tsx</strong>才能使用这种语法。</p>
<p>js&#x3D;&gt;jsx</p>
<h2 id="将组件改为函数调用形式并使用h函数"><a href="#将组件改为函数调用形式并使用h函数" class="headerlink" title="将组件改为函数调用形式并使用h函数"></a>将组件改为函数调用形式并使用h函数</h2><p>创建useCreateMessage.tsx文件</p>
<figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; h, render &#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Message</span> <span class="keyword">from</span> <span class="string">&quot;../components/Message.vue&quot;</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">type</span> <span class="title class_">MessageType</span> = <span class="string">&quot;error&quot;</span> | <span class="string">&quot;success&quot;</span> | <span class="string">&quot;default&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">useCreateMessage</span> = (<span class="params"></span></span><br><span class="line"><span class="params">  message: <span class="built_in">string</span>,</span></span><br><span class="line"><span class="params">  <span class="keyword">type</span>: MessageType,</span></span><br><span class="line"><span class="params">  timeout?: <span class="built_in">number</span></span></span><br><span class="line"><span class="params"></span>) =&gt; &#123;  </span><br><span class="line">  <span class="comment">// Message：要渲染的组件，&#123;message,type&#125;：需要的props</span></span><br><span class="line">  <span class="keyword">const</span> messageVnode = <span class="title function_">h</span>(<span class="title class_">Message</span>, &#123;</span><br><span class="line">    message,</span><br><span class="line">    <span class="keyword">type</span>,</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="comment">//mountNode要挂载的DOM节点</span></span><br><span class="line">  <span class="keyword">const</span> mountNode = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&quot;div&quot;</span>);</span><br><span class="line">  <span class="variable language_">document</span>.<span class="property">body</span>.<span class="title function_">appendChild</span>(mountNode);</span><br><span class="line">  <span class="comment">//render function将vnode渲染到特定节点。</span></span><br><span class="line">  <span class="comment">//需要两个参数，第一个为vnode，第二个为需要的dom节点</span></span><br><span class="line">  <span class="title function_">render</span>(messageVnode, mountNode);</span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">destory</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">//在特定的DOM节点上卸载，第一个参数为null</span></span><br><span class="line">    <span class="title function_">render</span>(<span class="literal">null</span>, mountNode);</span><br><span class="line">    <span class="variable language_">document</span>.<span class="property">body</span>.<span class="title function_">removeChild</span>(mountNode);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (timeout) &#123;</span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="title function_">destory</span>();</span><br><span class="line">    &#125;, timeout);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//实例上包括destory这个方法，无timeout时可以用程序的方式清空掉</span></span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    destory,</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> useCreateMessage;</span><br></pre></td></tr></table></figure>

    </div>
    
    <div class="post__license">
        <p>
            <strong>Author: </strong>Loploop
        </p>
        <p>
            <strong>
                Permalink: 
            </strong>
            <a href="https://kukupii.github.io/2022/10/30/%E9%80%9A%E7%94%A8%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86%E2%80%94%E2%80%94axios%E6%8B%A6%E6%88%AA/">https://kukupii.github.io/2022/10/30/%E9%80%9A%E7%94%A8%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86%E2%80%94%E2%80%94axios%E6%8B%A6%E6%88%AA/</a>
        </p>
        
    </div>
 
    <div class="post-footer__meta"><p>updated at 2022-11-17</p></div> 
    <div class="post-entry__tags"><a href="/tags/typescript/" class="post-tags__link button"># typescript</a><a href="/tags/vue/" class="post-tags__link button"># vue</a><a href="/tags/zheye/" class="post-tags__link button"># zheye</a><a href="/tags/error/" class="post-tags__link button"># error</a></div> 
</article>


    <div class="nav">
        <div class="nav__prev">
            
                <a href="/2022/11/03/%E6%8A%BD%E7%A6%BB%E7%BB%84%E4%BB%B6%E2%80%94%E2%80%94Uploader%E7%BB%84%E4%BB%B6/" class="nav__link">
                    <div>
                        <svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" width="24" height="24"><path d="M589.088 790.624L310.464 512l278.624-278.624 45.248 45.248L400.96 512l233.376 233.376z" fill="#808080"></path></svg>
                    </div>
                    <div>
                        <div class="nav__label">
                            Previous Post
                        </div>
                        <div class="nav__title">
                            抽离组件——Uploader组件
                        </div>
                    </div>
                </a>
            
        </div>
        <div class="nav__next">
            
                <a href="/2022/10/27/%E5%A6%82%E4%BD%95%E8%A7%A3%E5%86%B3%E7%94%A8%E6%88%B7%E7%99%BB%E9%99%86%E5%92%8C%E6%9D%83%E9%99%90%E8%AE%A4%E8%AF%81%E7%9B%B8%E5%85%B3%E9%97%AE%E9%A2%98/" class="nav__link">
                    <div>
                        <div class="nav__label">
                            Next Post
                        </div>
                        <div class="nav__title">
                            如何解决用户登陆和权限认证相关问题
                        </div>
                    </div>
                    <div>
                        <svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" width="24" height="24"><path d="M434.944 790.624l-45.248-45.248L623.04 512l-233.376-233.376 45.248-45.248L713.568 512z" fill="#808080"></path></svg>
                    </div>
                </a>
            
        </div>
    </div>



    <div class="post__comments post__with-toc content-card" id="comment">
        
    <h4>Comments</h4>
    
    <div id="disqus_thread">Unable to load Disqus, please make sure your network can access.</div>

    
    
    
    
    
    
    
    
    
    


    </div>



</main>

            <footer class="footer">
     
    <a href="#" class="button" id="b2t" aria-label="Back to Top" title="Back to Top">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1024 1024" width="32" height="32">
            <path d="M233.376 722.752L278.624 768 512 534.624 745.376 768l45.248-45.248L512 444.128zM192 352h640V288H192z" fill="currentColor"></path>
        </svg>
    </a>

    


    
     
 

 
    
        
        <p class="footer-copyright">
            Copyright © 2022&nbsp;-&nbsp;2023 <a href="/">Loplooop</a>
        </p>
    
    
    <p>Powered by <a href="https://hexo.io" target="_blank">Hexo</a> | Theme - <a href="https://github.com/ChrAlpha/hexo-theme-cards" target="_blank">Cards</a></p>
</footer>

        </div>
        
    <script defer src="https://cdn.jsdelivr.net/npm/vanilla-lazyload@17.1.0/dist/lazyload.min.js"></script>
    <script>
        window.lazyLoadOptions = {
            elements_selector: ".lazy",
            threshold: 0
        };
    </script>
 

 

 

 

 



 



 


    
 

 

 

 

 

 


    
    <script>
        function loadComment() {
            window.disqus_config = function () {
                this.page.url = 'https://kukupii.github.io/2022/10/30/%E9%80%9A%E7%94%A8%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86%E2%80%94%E2%80%94axios%E6%8B%A6%E6%88%AA/';
                this.page.identifier = '2022/10/30/通用错误处理——axios拦截/';
            };
            (function(){
                var dsq = document.createElement('script');
                dsq.type = 'text/javascript';
                dsq.async = true;
                dsq.src = '//' + 'https-kukupii-github-io' + '.disqus.com/embed.js';
                (document.head || document.body).appendChild(dsq);
            })();
        }
    
        var runningOnBrowser = typeof window !== "undefined";
        var isBot = runningOnBrowser && !("onscroll" in window) || typeof navigator !== "undefined" && /(gle|ing|ro|msn)bot|crawl|spider|yand|duckgo/i.test(navigator.userAgent);
        var supportsIntersectionObserver = runningOnBrowser && "IntersectionObserver" in window;
    
        setTimeout(function () {
            if (!isBot && supportsIntersectionObserver) {
                var comment_observer = new IntersectionObserver(function(entries) {
                    if (entries[0].isIntersecting) {
                        loadComment();
                        comment_observer.disconnect();
                    }
                }, { threshold: [0] });
                comment_observer.observe(document.getElementById('comment'));
            } else {
                loadComment();
            }
        }, 1);
    </script>


    
    
    

    
    
    
    
    

    
    
    
    
    

    
    
    



    </body>
</html>
